"use strict";var _a,__createBinding=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r);var i=Object.getOwnPropertyDescriptor(t,r);i&&!("get"in i?!t.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,i)}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),__setModuleDefault=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),__importStar=this&&this.__importStar||function(){var e=function(t){return e=Object.getOwnPropertyNames||function(e){var t=[];for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[t.length]=r);return t},e(t)};return function(t){if(t&&t.__esModule)return t;var r={};if(null!=t)for(var n=e(t),i=0;i<n.length;i++)"default"!==n[i]&&__createBinding(r,t,n[i]);return __setModuleDefault(r,t),r}}(),__awaiter=this&&this.__awaiter||function(e,t,r,n){return new(r||(r=Promise))(function(i,a){function o(e){try{s(n.next(e))}catch(e){a(e)}}function c(e){try{s(n.throw(e))}catch(e){a(e)}}function s(e){var t;e.done?i(e.value):(t=e.value,t instanceof r?t:new r(function(e){e(t)})).then(o,c)}s((n=n.apply(e,t||[])).next())})};Object.defineProperty(exports,"__esModule",{value:!0}),exports.TOTP=void 0;class TOTP{static generate(e,t){return __awaiter(this,void 0,void 0,function*(){const r=Object.assign({digits:6,algorithm:"SHA-1",encoding:"hex",period:30,timestamp:Date.now(),explicitZeroPad:!1},t),n=Math.floor(r.timestamp/1e3),i=_a.dec2hex(Math.floor(n/r.period)).padStart(16,"0"),a="hex"===r.encoding?_a.base32ToBuffer(e):_a.asciiToBuffer(e),o=yield _a._sign(a,i,r.algorithm),c=_a.buf2hex(o),s=2*_a.hex2dec(c.slice(-1)),u=(2147483647&_a.hex2dec(c.slice(s,s+8))).toString().slice(-r.digits),f=r.explicitZeroPad?u.padStart(r.digits,"0"):u,l=1e3*r.period;return{otp:f,expires:Math.ceil((r.timestamp+1)/l)*l}})}static hex2dec(e){return parseInt(e,16)}static dec2hex(e){return(e<15.5?"0":"")+Math.round(e).toString(16)}static base32ToBuffer(e){let t=(e=e.toUpperCase()).length;for(;61===e.charCodeAt(t-1);)t--;const r=new Uint8Array(5*t/8);let n=0,i=0,a=0;for(let o=0;o<t;o++){const t=_a.base32[e.charCodeAt(o)];if(void 0===t)throw new Error("Invalid base32 character in key");n=n<<5|t,i+=5,i>=8&&(r[a++]=n>>>(i-=8))}return r.buffer}static asciiToBuffer(e){const t=new Uint8Array(e.length);for(let r=0;r<e.length;r++)t[r]=e.charCodeAt(r);return t.buffer}static hex2buf(e){const t=new Uint8Array(e.length/2);for(let r=0,n=0;r<e.length;r+=2,n++)t[n]=_a.hex2dec(e.slice(r,r+2));return t.buffer}static buf2hex(e){return[...new Uint8Array(e)].map(e=>e.toString(16).padStart(2,"0")).join("")}}exports.TOTP=TOTP,_a=TOTP,TOTP._sign=(e,t,r)=>__awaiter(void 0,void 0,void 0,function*(){try{const n=(globalThis.crypto||require("node:crypto").webcrypto).subtle,i=yield n.importKey("raw",e,{name:"HMAC",hash:{name:r}},!1,["sign"]),a=_a.hex2buf(t);return yield n.sign("HMAC",i,a)}catch(n){const{default:i}=yield Promise.resolve().then(()=>__importStar(require("jssha"))),a=new i(r,"ARRAYBUFFER");return a.setHMACKey(e,"ARRAYBUFFER"),a.update(_a.hex2buf(t)),a.getHMAC("ARRAYBUFFER")}}),TOTP.base32={50:26,51:27,52:28,53:29,54:30,55:31,65:0,66:1,67:2,68:3,69:4,70:5,71:6,72:7,73:8,74:9,75:10,76:11,77:12,78:13,79:14,80:15,81:16,82:17,83:18,84:19,85:20,86:21,87:22,88:23,89:24,90:25};